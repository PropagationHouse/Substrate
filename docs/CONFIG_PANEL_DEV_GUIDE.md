# Config Panel Developer Guide

This document provides a comprehensive guide for developers who want to extend or customize the Tiny Pirate config panel system.

## Overview

The Tiny Pirate config panel uses a modern radial interface design implemented in `radial_config_new.js`. This design transforms the traditional form-based config panel into an interactive, 3D radial menu with multiple sections that can be navigated through rotation.

## Architecture

### Core Components

1. **Radial Panel Container**: The main container that holds all UI elements.
2. **Wheel Container**: A 3D-transformed container that rotates to show different sections.
3. **Section Cards**: Individual panels that contain configuration options for specific features.
4. **Navigation Controls**: UI elements for rotating between sections.
5. **Indicator Dots**: Visual indicators showing the current active section.

### File Structure

```
TPXGO/
├── radial_config_new.js   # Main implementation of the radial config panel
├── index.html             # Contains the original config panel that gets transformed
└── css/
    └── radial_config.css  # Styling for the radial config panel
```

## Extending the Config Panel

### Adding a New Section

To add a new section to the radial config panel:

1. **Update the sections array**:

```javascript
const sections = [
    { id: "agent-model", title: "Agent & Model" },
    { id: "system-prompt", title: "System Prompt" },
    // Add your new section here
    { id: "your-section-id", title: "Your Section Title" },
    // ...existing sections...
];
```

2. **Create a content generation function**:

```javascript
function getYourSectionContent() {
    return `
        <div class="your-section-class">
            <h4>Your Section Heading</h4>
            <div class="config-row">
                <label for="your-input-id">Your Setting:</label>
                <input type="text" id="your-input-id">
            </div>
            <div class="config-help">Help text for your setting.</div>
        </div>
    `;
}
```

3. **Add your section to the createSectionCards function**:

```javascript
function createSectionCards() {
    let cardsHTML = '';
    
    // Existing sections...
    
    // Your new section
    cardsHTML += createSectionCard("your-section-id", "Your Section Title", getYourSectionContent());
    
    // More existing sections...
    
    sectionCount = sections.length;
    return cardsHTML;
}
```

4. **Implement event handlers** for your new inputs in the setupEventListeners function.

### Customizing Existing Sections

Each section's content is generated by a corresponding function:

- **Agent & Model**: `getAgentModelContent()`
- **System Prompt**: `getSystemPromptContent()`
- **Screenshot Prompt**: `getScreenshotPromptContent()`
- **Note Creation**: `getNoteCreationContent()`
- **Autonomy Settings**: `getAutonomyContent()`
- **API Settings**: `getAPIContent()`

To modify an existing section, locate its content generation function and update the HTML it returns.

## Input Types and Patterns

The config panel supports various input types:

1. **Text Inputs**:
```html
<input type="text" id="your-text-input">
```

2. **Textareas** (for multi-line text):
```html
<textarea id="your-textarea" rows="6"></textarea>
```

3. **Checkboxes** (for boolean settings):
```html
<div class="config-row">
    <label for="your-checkbox">Enable Feature:</label>
    <input type="checkbox" id="your-checkbox">
</div>
```

4. **Number Inputs** (for numeric settings):
```html
<input type="number" id="your-number" min="1" max="100" value="50">
```

5. **Dropdowns** (for selection from options):
```html
<div class="model-select-radial">
    <div class="selected">
        <span class="model-name" id="selected-name">Default Option</span>
        <span class="model-arrow">▼</span>
    </div>
    <div class="model-options-radial" id="options-container">
        <!-- Options will be populated dynamically -->
    </div>
</div>
```

## Event Handling

The config panel uses event delegation to handle user interactions. When adding new inputs, you should:

1. **Add event listeners** in the setupEventListeners function:

```javascript
function setupEventListeners() {
    // Existing event listeners...
    
    // Your new event listener
    document.getElementById('your-input-id').addEventListener('change', function(e) {
        // Update the original input in the hidden panel
        const originalInput = originalConfigPanel.querySelector('#original-input-id');
        if (originalInput) {
            originalInput.value = e.target.value;
            
            // Trigger change event on original input
            const event = new Event('change', { bubbles: true });
            originalInput.dispatchEvent(event);
        }
    });
}
```

2. **Sync with original panel**: Ensure changes in the radial panel are reflected in the original hidden panel.

## Styling Guidelines

When adding new elements to the config panel, follow these styling guidelines:

1. Use the existing CSS classes for consistency:
   - `.config-row` for input rows
   - `.config-help` for help text
   - `.setting-group` for grouping related settings

2. For 3D effects, use transform properties similar to existing elements:
   - `transform: rotateY(angle) translateZ(distance)`

3. Follow the existing color scheme and visual style.

## Best Practices

1. **Maintain Backward Compatibility**: Always ensure your changes don't break existing functionality.

2. **Sync with Original Panel**: All inputs in the radial panel should update their counterparts in the original panel.

3. **Provide Help Text**: Include clear descriptions for all settings using the `.config-help` class.

4. **Test Thoroughly**: Test your changes in different browsers and screen sizes.

5. **Document Changes**: Update this guide when adding significant new features or changing existing behavior.

## Troubleshooting

Common issues and their solutions:

1. **Section not appearing**: Ensure you've added it to both the sections array and createSectionCards function.

2. **Inputs not saving**: Check that event listeners are properly updating the original panel inputs.

3. **Visual glitches**: Verify CSS transforms and z-index values are correctly set.

4. **Event handling issues**: Use browser developer tools to debug event propagation.

## Integration with Backend

The config panel communicates with the Python backend through IPC channels:

1. **Saving Configuration**: Changes are sent to the backend via IPC messages.
2. **Loading Configuration**: Initial values are loaded from the backend when the panel is opened.

When adding new settings, ensure they are properly handled in the backend configuration system.
